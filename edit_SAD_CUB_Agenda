<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edit Shared Agenda</title>

<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

<style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f0f0; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; flex-direction: column; }
    h1 { color: #333; }
    #edit-container { width: 80%; max-width: 900px; text-align: center; }
    #editor-container {
        height: 400px;
        background-color: white;
        font-size: 1.2em;
    }
    #button-container { margin-top: 20px; display: flex; justify-content: center; gap: 20px; }
    .action-btn { padding: 15px 30px; font-size: 1.2em; border: none; border-radius: 8px; cursor: pointer; color: white; }
    #save-btn { background-color: #28a745; }
    #clear-btn { background-color: #dc3545; }
</style>
</head>
<body>

<h1>Edit Your Agenda</h1>
<div id="edit-container">
    <div id="editor-container"></div>
    
    <div id="button-container">
        <button id="save-btn" class="action-btn">Save and Go Back</button>
        <button id="clear-btn" class="action-btn">Clear Agenda</button>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<script>
    // --- Your new Firebase Config for the Agenda App ---
    const firebaseConfig = {
      apiKey: "AIzaSyAJFEiLuC5J9N5c-pXgS1qvQri_ExpbuGE",
      authDomain: "sad-cub-agenda.firebaseapp.com",
      projectId: "sad-cub-agenda",
      storageBucket: "sad-cub-agenda.appspot.com",
      messagingSenderId: "38304426152",
      appId: "1:38304426152:web:fdadf5458c85db25d23a9d",
      measurementId: "G-HPNQ4WVG42"
    };

    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    const database = firebase.database();

    document.addEventListener('DOMContentLoaded', function() {
        const saveBtn = document.getElementById('save-btn');
        const clearBtn = document.getElementById('clear-btn');
        const agendaRef = database.ref('agendaContent');

        const quill = new Quill('#editor-container', {
            theme: 'snow',
            modules: {
                toolbar: [
                    [{ 'header': [1, 2, 3, false] }],
                    ['bold', 'italic', 'underline'],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    [{ 'color': [] }, { 'background': [] }],
                    ['clean']
                ]
            }
        });

        agendaRef.once('value', (snapshot) => {
            const currentContent = snapshot.val();
            if (currentContent) {
                quill.root.innerHTML = currentContent;
            }
        });

        saveBtn.addEventListener('click', function() {
            const newContent = quill.root.innerHTML;
            if (newContent === '<p><br></p>') {
                agendaRef.remove();
                window.location.href = 'index.html';
                return;
            }
            agendaRef.set(newContent)
                .then(() => {
                    window.location.href = 'index.html';
                })
                .catch(error => console.error("Save failed: ", error));
        });

        clearBtn.addEventListener('click', function() {
            if (confirm("Are you sure you want to clear the entire agenda?")) {
                agendaRef.remove().then(() => {
                    quill.setText('');
                });
            }
        });
    });
</script>

</body>
</html>
